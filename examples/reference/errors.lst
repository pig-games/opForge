asm485 8085 Assembler v1.0
ADDR    BYTES                    LINE  SOURCE
------  -----------------------  ----  ------
----                                1  ; Test and demonstrate assembly errors
----                                2  ; lines marked with ERR are detected by the assenbler
----                                3  ; lines marked as *ERR should be detected, but are currently not
----                                4  
----                                5  ; constants
----    EQU 0037                    6  symd1   equ 55          ; decimal constant
----                                7  symd2   equ 5X5         ; ERR: bad decimal constant
    7 | symd2   equ [31m5[0mX5         ; ERR: bad decimal constant
ERROR: Illegal character in decimal constant: 5X5
----                                8  symd3   equ 55X         ; ERR: bad decimal constant
    8 | symd3   equ [31m5[0m5X         ; ERR: bad decimal constant
ERROR: Illegal character in decimal constant: 55X
----    EQU 05A5                    9  symh1   equ 5A5h        ; hex constant
----                               10  symh2   equ 5A5         ; ERR: missing H for hex constant
   10 | symh2   equ [31m5[0mA5         ; ERR: missing H for hex constant
ERROR: Illegal character in decimal constant: 5A5
----                               11  symh3   equ ffffH       ; ERR: hex must start with numeric
   11 | symh3   equ [31mf[0mfffH       ; ERR: hex must start with numeric
ERROR: Label not found: ffffH
----    EQU FFFF                   12  symh4   equ 0ffffH      ; Hex with leading zero
----    EQU 0066                   13  symb1   equ 01100110b   ; Binary constant
----                               14  symb2   equ 01101210b   ; ERR: bad binary constant
   14 | symb2   equ [31m0[0m1101210b   ; ERR: bad binary constant
ERROR: Illegal character in binary constant: 01101210b
----    EQU 0053                   15  symq1   equ 123q        ; octal constant
----                               16  symq2   equ 128o        ; ERR: bad octal constant
   16 | symq2   equ [31m1[0m28o        ; ERR: bad octal constant
ERROR: Illegal character in octal constant: 128o
----                               17  
----    EQU 0077                   18  bah     equ 77h
----                               19  bad:    db  "where is the end  ; ERR: unterminated string
   19 | bad:    db  [31m"[0mwhere is the end  ; ERR: unterminated string
ERROR: Unterminated string: "where is the end  ; ERR: unterminated string
0000    09 0A 0D 77                20  special:db  "\t\n\r",bah,beh, bad  ; ERR: undefined symbol
   20 | special:db  "\t\n\r",bah,[31mb[0meh, bad  ; ERR: undefined symbol
ERROR: Label not found: beh
----                               21  
----                               22  ; column zero
----                               23  LABEL1:                 ; label can start in column 0
0004    4F                         24  LABEL2: MOV   C,A       ; label with instruction also OK
----    EQU 0007                   25  NAME1   EQU   7         ; name can start in column zero
----                               26  123                     ; ERR: not name or label
   26 | [31m1[0m23                     ; ERR: not name or label
ERROR: Illegal character in column 1.  Must be label, name, comment, or space. Found: 123                     ; ERR: not name or label
----                               27  "abc"                   ; ERR: not name or label
   27 | [31m"[0mabc"                   ; ERR: not name or label
ERROR: Illegal character in column 1.  Must be label, name, comment, or space. Found: "abc"                   ; ERR: not name or label
----                               28  +                       ; ERR: not name or label
   28 | [31m+[0m                       ; ERR: not name or label
ERROR: Illegal character in column 1.  Must be label, name, comment, or space. Found: +                       ; ERR: not name or label
----                               29  mov h,l                 ; ERR: instruction can't start in column zero
   29 | [31mm[0mov h,l                 ; ERR: instruction can't start in column zero
ERROR: Expecting label, comment, or space n column 1, found: mov
----                               30  
----                               31  ; extra information on line and extra/incorrect arguments
----                               32          nop     SP      ; ERR: extra register argument
   32 |         nop     [31mS[0mP      ; ERR: extra register argument
ERROR: Wrong number of register arguments for instruction: nop
----                               33          nop     d,e     ; ERR: multiple extra registers
   33 |         nop     d,[31me[0m     ; ERR: multiple extra registers
ERROR: Wrong number of register arguments for instruction: nop
0005    00                         34          nop     str     ; ERR: extra expression argument
   34 |         nop     [31ms[0mtr     ; ERR: extra expression argument
ERROR: Additional arguments after instruction: str
0006    00                         35          nop     12XX    ; ERR: extra characters
   35 |         nop     [31m1[0m2XX    ; ERR: extra characters
ERROR: Additional arguments after instruction: 12XX
----                               36          MOV     A       ; ERR: missing second register
   36 |         MOV     [31mA[0m       ; ERR: missing second register
ERROR: Wrong number of register arguments for instruction: MOV
----                               37          MOV     A,4     ; ERR: missing second register
   37 |         MOV     A,[31m4[0m     ; ERR: missing second register
ERROR: Wrong number of register arguments for instruction: MOV
0007    06                         38          MVI     B,A     ; ERR: second arg should be expression
   38 |         MVI     B,[31mA[0m     ; ERR: second arg should be expression
ERROR: Label not found: A
0008    C3                         39          JMP     SP      ; ERR: first arg should be expression
   39 |         JMP     [31mS[0mP      ; ERR: first arg should be expression
ERROR: Label not found: SP
0009    CA                         40          JZ              ; ERR: missing arg
   40 |         JZ              [31m;[0m ERR: missing arg
ERROR: Expected label or numeric constant, found: ;
000A    06                         41          MVI     b,1+2+  ; ERR: extra chars in expression
   41 |         MVI     b,1+2+  [31m;[0m ERR: extra chars in expression
ERROR: Expected label or numeric constant, found: ;
----                               42  
----                               43  ; RST instructions
000B    C7                         44          RST     0       ; OK
----                               45          RST     A       ; ERR: must be number
   45 |         RST     [31mA[0m       ; ERR: must be number
ERROR: RST instruction argument must be 0-7: A
----    EQU 0001                   46  RNUM    equ     1
----                               47          RST     RNUM    ; ERR: expression not allowed
   47 |         RST     [31mR[0mNUM    ; ERR: expression not allowed
ERROR: RST instruction argument must be 0-7: RNUM
000C    CF                         48          RST     1+1     ; ERR: expression not allowed
   48 |         RST     1[31m+[0m1     ; ERR: expression not allowed
ERROR: Found extra arguments after RST instruction: +
000D    FF                         49          RST     7       ; OK
----                               50          RST     9       ; ERR: RST number must be 0..7
   50 |         RST     [31m9[0m       ; ERR: RST number must be 0..7
ERROR: RST instruction argument must be 0-7: 9
----                               51  
----                               52  ; characters in expressions      
000E    06 50                      53          mvi     b,'P'   ; single char is a byte
0010    11 52 51                   54          lxi     d,'QR'  ; two chars is a sixteen bit value
0013    1E                         55          mvi     e,'abc' ; ERR: Can't use string in expression
   55 |         mvi     e,[31m'[0mabc' ; ERR: Can't use string in expression
ERROR: Multi-character string not allowed in expression.
0014    01 02 19                   56          lxi     b,'a'*'B' ; weird, but legal
----                               57  
----                               58  
----                               59  ; math
----                               60  var1    equ     23 / 0  ; ERR: divide by zero
   60 | var1    equ     23 / 0  [31m;[0m ERR: divide by zero
ERROR: Divide by zero
0017    09 01                      61  var2:   dw      255 + 10; OK as a 16 bit value
0019    09                         62  var3:   db      255 + 10; *ERR: 8 bit constant overflow
----                               63  
----                               64  
----                               65  ; name/label mismatch
001A    07 00                      66  nam1    dw  7           ; ERR: dw uses label, not name
001C    +000A                      67  nam2    ds  10          ; ERR: ds uses label, not name
----                               68  nam3    jmp 0           ; ERR: instruction uses label, not name
   68 | [31mn[0mam3    jmp 0           ; ERR: instruction uses label, not name
ERROR: Expecting label, comment, or space n column 1, found: nam3
----                               69  lab1:   equ 6           ; ERR: equ uses name, not label
   69 | [31ml[0mab1:   equ 6           ; ERR: equ uses name, not label
ERROR: EQU or SET name should not end in ':'
----                               70  lab2:   set 8           ; ERR: set uses name, not label
   70 | [31ml[0mab2:   set 8           ; ERR: set uses name, not label
ERROR: EQU or SET name should not end in ':'
----                               71  
----                               72  ; redeine symbols and labels
----    EQU 0001                   73  equ1    equ 1           ; OK
----                               74  equ1    equ 2           ; ERR: redefined symbol with EQU
   74 | [31me[0mqu1    equ 2           ; ERR: redefined symbol with EQU
ERROR: symbol has already been defined: equ1
----    EQU 0001                   75  set1    set 1           ; OK
----    EQU 0002                   76  set1    set 2           ; OK, can redefine SET
----    EQU 0003                   77  set1    equ 3           ; should be an error to mix set and equ
----    EQU 0004                   78  set1    set 4           ; OK, can redefine SET
----    EQU 0002                   79  equ2    equ 2           ; OK
----                               80  equ2    set 3           ; ERR: cannot redefine EQU
   80 | [31me[0mqu2    set 3           ; ERR: cannot redefine EQU
ERROR: symbol has already been defined: equ2
----                               81  
0026    C3 00 00                   82  lab3:   jmp 0           ; OK
----                               83  lab3:   jmp 1           ; ERR: label redefined
   83 | [31ml[0mab3:   jmp 1           ; ERR: label redefined
ERROR: Symbol defined more than once: lab3
0029    C3 02 00                   84  lab4:   jmp 2           ; OK
----                               85  
----                               86  
----                               87  ; Conditional directives
----    EQU 0001                   88  YES         EQU 1
----    EQU FFFF                   89  TRUE        EQU 0ffffh
----    EQU 0000                   90  NO          EQU 0
----    EQU 0000                   91  FALSE       EQU 0
----                               92  
----    EQU 5000                   93                  org 5000h
----                               94  ; ERR - missing IF
----                               95          .elseif YES                     ; ERR - missing IF
   95 |         .elseif [31mY[0mES                     ; ERR - missing IF
ERROR: .else or .elseif found without matching .if
----                               96          .else                           ; ERR - missing IF
   96 |         .else                           [31m;[0m ERR - missing IF
ERROR: .else or .elseif found without matching .if
----                               97          .endif                          ; ERR - missing IF
   97 |         .endif                          [31m;[0m ERR - missing IF
ERROR: .endif found without matching .if
----                               98  
----                               99  
----                              100  ; ERR - multiple ELSE
----                              101          .if FALSE                       ; OK
----                              102          .else                           ; OK
----                              103          .else                           ; ERR - multiple ELSE
  103 |         .else                           [31m;[0m ERR - multiple ELSE
ERROR: .else or .elseif cannot follow .else
----                              104          .endif
----                              105  
----                              106  
----                              107  ; ERR - ELSEIF follows ELSE
----                              108          .if FALSE                       ; OK
----                              109          .else                           ; OK
----                              110          .elseif TRUE                    ; ERR - ELSEIF follows ELSE
  110 |         .elseif [31mT[0mRUE                    ; ERR - ELSEIF follows ELSE
ERROR: .else or .elseif cannot follow .else
----                              111          .endif
----                              112         
----                              113  
----                              114  ; ERR - missing ENDIF
----                              115          .if FALSE || 3+1 == 4           ; OK
5000    21 EF BE                  116                  lxi h,0beefh
  117 | <source unavailable>
ERROR: Found .if without .endif

Lines: 116  Errors: 40  Warnings: 0

SYMBOL TABLE

symd1           : 0037 (55)
symh1           : 05a5 (1445)
symh3           : 0000 (0)
symh4           : ffff (65535)
symb1           : 0066 (102)
symq1           : 0053 (83)
bah             : 0077 (119)
special         : 0000 (0)
LABEL1          : 0004 (4)
LABEL2          : 0004 (4)
NAME1           : 0007 (7)
RNUM            : 0001 (1)
var2            : 0017 (23)
var3            : 0019 (25)
lab1            : 0026 (38)
lab2            : 0026 (38)
equ1            : 0001 (1)
set1            : 0004 (4)
equ2            : 0002 (2)
lab3            : 0026 (38)
lab4            : 0029 (41)
YES             : 0001 (1)
TRUE            : ffff (65535)
NO              : 0000 (0)
FALSE           : 0000 (0)

Total memory is 37 bytes
